<!-- CHANGED: add (submit) preventDefault to avoid accidental form submit -->
<div class="blury-grey profile-card p-5" style="max-width: 960px;">
  <form (submit)="$event.preventDefault()">
    <div class="row">
      <!-- Profile Picture -->
      <div class="col-md-4 d-flex align-items-center justify-content-center">
        <div class="profile-pic-wrapper position-relative" (click)="triggerFileInput()">
          <img [src]="profileImage" alt="Profile" class="profile-pic rounded-circle" />
          <div class="overlay text-white d-flex justify-content-center align-items-center">Change</div>
        </div>
        <input type="file" #fileInput (change)="onFileSelected($event)" hidden />
      </div>
 
      <!-- Profile Info -->
      <div class="col-md-8">
        <div class="form-group mb-3">
          <label>Username</label>
          <div *ngIf="!editMode">{{ username }}</div>
          <!-- CHANGED: added name attribute required for ngModel inside a form -->
          <input *ngIf="editMode" name="newUsername" [(ngModel)]="newUsername" class="form-control" />
        </div>

        <div class="form-group mb-3">
          <label>Email</label>
          <div *ngIf="!editMode">{{ email }}</div>
          <!-- CHANGED: added name attribute -->
          <input *ngIf="editMode" name="newEmail" [(ngModel)]="newEmail" class="form-control" />
        </div>

        <div class="form-group mb-3">
          <label>Password</label>
          <div *ngIf="!editMode">{{ password }}</div>

          <div *ngIf="editMode">
            <!-- CHANGED: name attributes added -->
            <input type="password" name="newPassword" [(ngModel)]="newPassword" class="form-control mb-2" (input)="checkPasswords()"
              placeholder="New Password" />
            <input type="password" name="confirmPassword" [(ngModel)]="confirmPassword" class="form-control" (input)="checkPasswords()"
              placeholder="Confirm Password" />
            <small *ngIf="newPassword && confirmPassword"
              [ngClass]="{ 'text-danger': !passwordMatch, 'text-success': passwordMatch }">
              {{ passwordMatch ? 'Passwords match' : 'Passwords do not match' }}
            </small>
          </div>
        </div>

        <div class="form-group mb-3">
          <label>Date Created</label>
          <div>{{ createdAt }}</div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex flex-column align-items-center mt-4">

          <!-- CHANGED: This block now handles three states
               1) Not editing & not prompting delete  -> show Change Info + Delete
               2) Not editing & prompting delete      -> show Confirm + Cancel (in-place)
               3) editMode                             -> show Save + Cancel (editing controls)
          -->
          <ng-container *ngIf="!editMode">
            <ng-container *ngIf="!deleteConfirmMode; else deleteConfirmBlock">
              <!-- CHANGED: added type="button" to prevent form submit -->
              <button type="button" class="btn btn-primary w-100 mb-2" (click)="toggleEdit()">Change Info</button>

              <!-- CHANGED: Delete button appears exactly when Change Info appears -->
              <button type="button" class="btn btn-danger w-100" (click)="promptDelete()">Delete Account</button>
            </ng-container>

            <!-- CHANGED: in-place confirm + cancel replacing Change Info + Delete -->
            <ng-template #deleteConfirmBlock>
              <div class="w-100">
                <div class="mb-2 text-center confirm-warning">Are you sure you want to delete your account?</div>
                <button type="button" class="btn btn-danger w-100 mb-2" (click)="confirmDelete()">Confirm Delete</button>
                <button type="button" class="btn btn-secondary w-100" (click)="cancelPromptDelete()">Cancel</button>
              </div>
            </ng-template>
          </ng-container>

          <!-- Edit mode buttons (unchanged logic but add type="button") -->
          <div *ngIf="editMode" class="w-100">
            <button type="button" class="btn btn-success w-100 mb-2" (click)="saveChanges()">Save Changes</button>
            <button type="button" class="btn btn-secondary w-100" (click)="cancelChanges()">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
